<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://docs.msupply.foundation/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://docs.msupply.foundation/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="stylesheet" href="https://docs.msupply.foundation/main.css">
<link rel="stylesheet" href="https://docs.msupply.foundation/msupply.css">




  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>Integration with mSupply Dashboard - mSupply</title>
<meta name="description" content="mSupply Coldchain sensor setup.">
<link rel="canonical" href="https://docs.msupply.foundation/coldchain/dashboard/">










<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://docs.msupply.foundation/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Coldchain",
            "item": "https://docs.msupply.foundation/coldchain/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Dashboard",
            "item": "https://docs.msupply.foundation/coldchain/dashboard/"
          },
        
      
    
  }
</script>






  <meta name="theme-color" content="#fff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://docs.msupply.foundation/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://docs.msupply.foundation/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://docs.msupply.foundation/favicon-16x16.png">
  
    <link rel="manifest" href="https://docs.msupply.foundation/site.webmanifest" crossorigin>
  


  

</head>
 
   

<body class="docs single">
   
   
   
  

    

<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://docs.msupply.foundation">mSupply</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://twitter.com/mSupply"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ms-2 visually-hidden">Twitter</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
				
				
				
					
						<li class="nav-item">
							<a class="nav-link" href="https://docs.msupply.foundation/docs/introduction/">Desktop</a>
						</li>
					
						<li class="nav-item coldchain active">
							<a class="nav-link" href="https://docs.msupply.foundation/coldchain/introduction/">Coldchain</a>
						</li>
					
						<li class="nav-item">
							<a class="nav-link" href="https://docs.msupply.foundation/dashboard/introduction/">Dashboard</a>
						</li>
					
						<li class="nav-item">
							<a class="nav-link" href="https://docs.msupply.foundation/mobile/introduction/">Mobile</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
				<form class="navbar-form flex-grow-1 order-7 order-md-3">
					<input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
						aria-label="Search docs..." autocomplete="off">
					<div id="suggestions" class="shadow bg-white rounded"></div>
				</form>
			
		</div>
	</div>
</header>
 


  

<div class="wrap container" role="document">
  <div class="content">
    <div class="row flex-xl-nowrap">
      
<div class="col-lg-5 col-xl-4 docs-sidebar">
	<nav class="docs-links" aria-label="Main navigation">
		
			
		
			
			
					<h3>mSupply Coldchain</h3>
					<ul class="list-unstyled">
					                           
							<li><a class="docs-link" href="https://docs.msupply.foundation/coldchain/introduction/">mSupply Coldchain</a></li>
					                           
							<li><a class="docs-link" href="https://docs.msupply.foundation/coldchain/getting-started/">Getting started</a></li>
					                           
							<li><a class="docs-link" href="https://docs.msupply.foundation/coldchain/using-coldchain/">Using mSupply Coldchain</a></li>
					                           
							<li><a class="docs-link" href="https://docs.msupply.foundation/coldchain/settings/">mSupply Coldchain Settings</a></li>
					                           
							<li><a class="docs-link" href="https://docs.msupply.foundation/coldchain/desktop-integration/">Integration with mSupply Desktop</a></li>
					                           
							<li><a class="docs-link active" href="https://docs.msupply.foundation/coldchain/dashboard/">Integration with mSupply Dashboard</a></li>
					
					</ul>
			
			
					
					
					
					
			
	</nav>
</div>
  
<nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
  <div class="page-links">
    <h3>On this page</h3>
    <nav id="TableOfContents">
      <ul>
        
        <li><a href="https://docs.msupply.foundation/coldchain/dashboard/#introduction">Introduction</a></li>
         
        <li><a href="https://docs.msupply.foundation/coldchain/dashboard/#sensor-graph">Sensor Graph</a></li>
         
        <li><a href="https://docs.msupply.foundation/coldchain/dashboard/#unacknowledged-breaches">Unacknowledged Breaches</a></li>
         
        <li><a href="https://docs.msupply.foundation/coldchain/dashboard/#batches-affected">Batches affected</a></li>
         
        <li><a href="https://docs.msupply.foundation/coldchain/dashboard/#sensor-battery-life">Sensor battery life</a></li>
         
        <li><a href="https://docs.msupply.foundation/coldchain/dashboard/#telegram-notifications-for-cold-chain">Telegram notifications for Cold Chain</a></li>
         
      </ul>
    </nav>
  </div>
</nav>
 
      <main class="docs-content col-lg-11 col-xl-9">
        
        <div class="flagster" style="float: right; padding: 5px">
          <a href="https:&#x2F;&#x2F;docs.msupply.foundation&#x2F;coldchain&#x2F;dashboard&#x2F;" title="Change language to en"
            >ðŸ‡¬ðŸ‡§</a
          >
        </div>
        

        <h1>Integration with mSupply Dashboard</h1>
         <h3 id="introduction">Introduction<a class="zola-anchor" href="#introduction" aria-label="Anchor link for: introduction">ðŸ”—</a></h3>
<p>One of the things that makes mSupply Coldchain unique is that, when integrated with mSupply Desktop, it can not only tell you when there has been a breach, but also which batches have been affected.</p>
<p>The following examples use the mSupply Grafana dashboard to visualise information. Usually a consultant from the mSupply Foundation will set these up for you, but they're recorded below for users who have the skill, or who may want to tweak a query to suit their particular situation.</p>
<p>These queries generally need to be set up by an administrator but have been included here as a reference to demonstrate some of the mSupply cold chain data that can be made available on the mSupply Dashboard.</p>
<h3 id="sensor-graph">Sensor Graph<a class="zola-anchor" href="#sensor-graph" aria-label="Anchor link for: sensor-graph">ðŸ”—</a></h3>
<p><img src="/coldchain/images/dashboard_sensor_graph.png" alt="Dashboard Sensor Graph!" /></p>
<p><strong>Query:</strong></p>
<pre data-lang="sql" style="background-color:#2b303b;color:#c0c5ce;" class="language-sql "><code class="language-sql" data-lang="sql"><span style="color:#b48ead;">WITH</span><span> temp AS (
</span><span style="color:#b48ead;">SELECT 
</span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">name</span><span>,
</span><span>CONCAT(TO_CHAR(</span><span style="color:#b48ead;">date</span><span>,&#39;</span><span style="color:#a3be8c;">YYYY-MM-DD</span><span>&#39;),&#39; &#39;, TO_CHAR(</span><span style="color:#b48ead;">time</span><span>,&#39;</span><span style="color:#a3be8c;">HH24:MI:SS</span><span>&#39;))::</span><span style="color:#b48ead;">timestamptz </span><span>AS log_datetime,
</span><span style="color:#d08770;">tl</span><span>.</span><span style="color:#d08770;">temperature 
</span><span style="color:#b48ead;">FROM</span><span> temperature_log tl 
</span><span style="color:#b48ead;">JOIN</span><span> sensor s ON </span><span style="color:#d08770;">tl</span><span>.</span><span style="color:#d08770;">sensor_id </span><span>= </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">id 
</span><span style="color:#b48ead;">WHERE
</span><span>CONCAT(TO_CHAR(</span><span style="color:#b48ead;">date</span><span>,&#39;</span><span style="color:#a3be8c;">YYYY-MM-DD</span><span>&#39;),&#39; &#39;, TO_CHAR(</span><span style="color:#b48ead;">time</span><span>,&#39;</span><span style="color:#a3be8c;">HH24:MI:SS</span><span>&#39;))::</span><span style="color:#b48ead;">timestamptz </span><span>&gt;= $__timeFrom() 
</span><span>)
</span><span style="color:#b48ead;">SELECT
</span><span>$__time(log_datetime),
</span><span>name,
</span><span>temperature
</span><span style="color:#b48ead;">FROM</span><span> temp
</span><span style="color:#b48ead;">ORDER BY</span><span> log_datetime
</span></code></pre>
<h3 id="unacknowledged-breaches">Unacknowledged Breaches<a class="zola-anchor" href="#unacknowledged-breaches" aria-label="Anchor link for: unacknowledged-breaches">ðŸ”—</a></h3>
<p><img src="/coldchain/images/unacknowledged_breaches_dashboard.png" alt="Unacknowledged Breaches!" /></p>
<p><strong>Query:</strong></p>
<pre data-lang="sql" style="background-color:#2b303b;color:#c0c5ce;" class="language-sql "><code class="language-sql" data-lang="sql"><span style="color:#b48ead;">WITH</span><span> breaches AS (
</span><span style="color:#b48ead;">SELECT 
</span><span>        store_id, 
</span><span>        location_id, 
</span><span>        sensor_id,
</span><span>        </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">name</span><span>,
</span><span>        </span><span style="color:#96b5b4;">SUM</span><span>(</span><span style="color:#b48ead;">CASE WHEN</span><span> type = &#39;</span><span style="color:#a3be8c;">HOT_CONSECUTIVE</span><span>&#39; or type = &#39;</span><span style="color:#a3be8c;">COLD_CONSECUTIVE</span><span>&#39; </span><span style="color:#b48ead;">then </span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">else </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">end</span><span>) AS count_consecutive
</span><span>    </span><span style="color:#b48ead;">FROM</span><span> temperature_breach 
</span><span>    </span><span style="color:#b48ead;">JOIN</span><span> sensor s ON </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">id </span><span>= </span><span style="color:#d08770;">temperature_breach</span><span>.</span><span style="color:#d08770;">sensor_id
</span><span>    </span><span style="color:#b48ead;">WHERE</span><span> CONCAT(TO_CHAR(start_date,&#39;</span><span style="color:#a3be8c;">YYYY-MM-DD</span><span>&#39;),&#39; &#39;, TO_CHAR(start_time,&#39;</span><span style="color:#a3be8c;">HH24:MI:SS</span><span>&#39;))::</span><span style="color:#b48ead;">timestamp </span><span>&gt;= $__timeFrom() 
</span><span>    AND acknowledged=&#39;</span><span style="color:#a3be8c;">false</span><span>&#39;
</span><span>    </span><span style="color:#b48ead;">GROUP BY</span><span> store_id, location_id,sensor_id, </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">name</span><span>)
</span><span>
</span><span style="color:#b48ead;">SELECT </span><span style="color:#96b5b4;">COUNT</span><span>(</span><span style="color:#bf616a;">*</span><span>) </span><span style="color:#b48ead;">FROM</span><span> breaches
</span><span>
</span></code></pre>
<h3 id="batches-affected">Batches affected<a class="zola-anchor" href="#batches-affected" aria-label="Anchor link for: batches-affected">ðŸ”—</a></h3>
<p><img src="/coldchain/images/batches_affected_dashboard.png" alt="Batches affected!" /></p>
<p><strong>Query:</strong></p>
<pre data-lang="sql" style="background-color:#2b303b;color:#c0c5ce;" class="language-sql "><code class="language-sql" data-lang="sql"><span style="color:#b48ead;">WITH</span><span> batch_count AS (
</span><span style="color:#b48ead;">SELECT
</span><span>        </span><span style="color:#d08770;">temperature_breach</span><span>.</span><span style="color:#d08770;">store_id</span><span>, 
</span><span>        </span><span style="color:#d08770;">temperature_breach</span><span>.</span><span style="color:#d08770;">location_id</span><span>, 
</span><span>        sensor_id,
</span><span>        </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">name</span><span>,
</span><span>        </span><span style="color:#d08770;">il</span><span>.</span><span style="color:#d08770;">id</span><span>,
</span><span>        </span><span style="color:#96b5b4;">SUM</span><span>(</span><span style="color:#b48ead;">CASE WHEN</span><span> type = &#39;</span><span style="color:#a3be8c;">HOT_CONSECUTIVE</span><span>&#39; or type = &#39;</span><span style="color:#a3be8c;">COLD_CONSECUTIVE</span><span>&#39; </span><span style="color:#b48ead;">then </span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">else </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">end</span><span>) AS count_consecutive
</span><span>    </span><span style="color:#b48ead;">FROM</span><span> temperature_breach 
</span><span>    </span><span style="color:#b48ead;">JOIN</span><span> sensor s ON </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">id </span><span>= </span><span style="color:#d08770;">temperature_breach</span><span>.</span><span style="color:#d08770;">sensor_id
</span><span>    </span><span style="color:#b48ead;">JOIN</span><span> item_line il ON </span><span style="color:#d08770;">il</span><span>.</span><span style="color:#d08770;">location_id </span><span>= </span><span style="color:#d08770;">temperature_breach</span><span>.</span><span style="color:#d08770;">location_id
</span><span>    </span><span style="color:#b48ead;">WHERE</span><span> CONCAT(TO_CHAR(start_date,&#39;</span><span style="color:#a3be8c;">YYYY-MM-DD</span><span>&#39;),&#39; &#39;, TO_CHAR(start_time,&#39;</span><span style="color:#a3be8c;">HH24:MI:SS</span><span>&#39;))::</span><span style="color:#b48ead;">timestamp </span><span>&gt;= $__timeFrom() 
</span><span>    AND acknowledged=&#39;</span><span style="color:#a3be8c;">false</span><span>&#39;
</span><span>    </span><span style="color:#b48ead;">GROUP BY </span><span style="color:#d08770;">temperature_breach</span><span>.</span><span style="color:#d08770;">store_id</span><span>, </span><span style="color:#d08770;">temperature_breach</span><span>.</span><span style="color:#d08770;">location_id</span><span>,sensor_id, </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">name</span><span>, </span><span style="color:#d08770;">il</span><span>.</span><span style="color:#d08770;">id
</span><span>
</span><span>)
</span><span style="color:#b48ead;">SELECT </span><span style="color:#96b5b4;">COUNT</span><span>(</span><span style="color:#bf616a;">*</span><span>) </span><span style="color:#b48ead;">FROM</span><span> batch_count
</span></code></pre>
<h3 id="sensor-battery-life">Sensor battery life<a class="zola-anchor" href="#sensor-battery-life" aria-label="Anchor link for: sensor-battery-life">ðŸ”—</a></h3>
<p><img src="/coldchain/images/sensor_batter_life_dashboard.png" alt="Sensor battery life!" /></p>
<p><strong>Query:</strong></p>
<pre data-lang="sql" style="background-color:#2b303b;color:#c0c5ce;" class="language-sql "><code class="language-sql" data-lang="sql"><span style="color:#b48ead;">select 
</span><span style="color:#96b5b4;">sum</span><span>(</span><span style="color:#b48ead;">CASE WHEN</span><span> batterylevel &lt; </span><span style="color:#d08770;">20 </span><span style="color:#b48ead;">then </span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">else </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">end</span><span>) as &quot;</span><span style="color:#a3be8c;">Low battery</span><span>&quot;,
</span><span style="color:#96b5b4;">sum</span><span>(</span><span style="color:#b48ead;">CASE WHEN</span><span> batterylevel &lt; </span><span style="color:#d08770;">50 </span><span style="color:#b48ead;">then </span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">else </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">end</span><span>) as &quot;</span><span style="color:#a3be8c;">Battery to be replaced within month</span><span>&quot;,
</span><span style="color:#96b5b4;">sum</span><span>(</span><span style="color:#b48ead;">CASE WHEN</span><span> batterylevel &gt;= </span><span style="color:#d08770;">50 </span><span style="color:#b48ead;">then </span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">else </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">end</span><span>) as &quot;</span><span style="color:#a3be8c;">Battery OK</span><span>&quot;
</span><span style="color:#b48ead;">from</span><span> sensor s
</span><span style="color:#b48ead;">where </span><span style="color:#d08770;">s</span><span>.</span><span style="color:#d08770;">is_active </span><span>= </span><span style="color:#d08770;">true 
</span><span>
</span></code></pre>
<h3 id="telegram-notifications-for-cold-chain">Telegram notifications for Cold Chain<a class="zola-anchor" href="#telegram-notifications-for-cold-chain" aria-label="Anchor link for: telegram-notifications-for-cold-chain">ðŸ”—</a></h3>
<p>General instructions are here: https://gist.github.com/ilap/cb6d512694c3e4f2427f85e4caec8ad7</p>
<p>But note that you need to invite your bot, not the bot father to the channel</p>
<p>Temperature logs rely on the using mSupply Desktop to transfer mSupply Coldchain records from the tablet to the server. If the mSupply Desktop (alternate) web server is not running then no logs will be synced (and hence nothing will show on the Dashboard).</p>
<p>You can test if the alternate server process is really running by checking port 8081 in Windows cmd with </p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>netstat -ano | findstr :8081 In this case process with ID 2188 is running ok. 
</span></code></pre>
<p><img src="/coldchain/images/alternate_server_test.png" alt="Hey mSupply Desktop- you serving today?!" /></p>
  
<div class="docs-navigation d-flex justify-content-between">
  
  
  
  
  

  
  
  
  
  
    
    
    
    
  
</div>

      </main>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Powered by <a href="https://www.getzola.org/">Zola</a>, and <a href="https://github.com/aaranxu/adidoks">AdiDoks</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

  
<script type="text/javascript" src="https://docs.msupply.foundation/js/main.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>

  <script type="text/javascript" src="https://docs.msupply.foundation/plugins/elasticlunr.min.js" defer></script>
  <script type="text/javascript" src="https://docs.msupply.foundation/plugins/lunr.stemmer.support.js" defer></script>
  <script type="text/javascript" src="https://docs.msupply.foundation/plugins/lunr.fr.js" defer></script>
  <script type="text/javascript" src="https://docs.msupply.foundation/search_index.en.js" defer></script>
  <script type="text/javascript" src="https://docs.msupply.foundation/js/search.js" defer></script>

  
</body>
</html>
